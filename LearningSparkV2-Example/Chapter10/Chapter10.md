## Chapter 10. MLlib을 사용한 머신러닝

## 작성자: 구민규

## 10 요약 

### 1. 머신러닝이란 무엇인가?
### 2. 머신러닝 파이프라인 설계
### 3. 하이퍼파라미터 튜닝

## 1. 머신러닝이란 무엇인가?

- 머신러닝은 학습방식에 따라 아래와 같이 분류될 수 있다.
    1. 지도(supervised)학습 - 레이블이 존재하는 데이터로 학습 => 레이블이 없는 데이터의 레이블 예측
    2. 반지도(semi-supervised)학습 - 레이블이 없는 데이터를 지도학습에 사용 => 분류 테스크에서 인접한 미분류 데이터를 동일 집단으로 레이블링하여 학습에 사용
    3. 비지도(unsupervised)학습 - 데이터의 구성,특징,패턴을 스스로 학습하는 방식
    4. 강화(reinforcement)학습 - 에이전트가 환경과 상호작용하면서 보상을 통해 학습하는 방식으로, 에이전트는 보상을 최대화하도록 행동하며 환경은 에이전트의 행동에 따라 보상을 제공
    
### 지도학습

- 데이터에 해당되는 레이블(정답값)이 존재하며, 목표는 레이블이 없는 새로운 데이터의 레이블(정답)을 예측하는 것.

- 레이블이 이산적(discreate)이냐 연속적(continuous)이냐에 따라 분류(classification)과 회귀(regression)으로 나뉠 수 있다.

- 인기 있는 분류 및 회귀 알고리즘

|알고리즘|전형적인 사용|
|---|---|
|선형 회귀(linear regression)|회귀|
|로지스틱 회귀(logistic regression)|분류|
|의사결정나무(decision trees)|둘 다|
|그레디언트 부스트 트리(gradient boosted tree)|둘 다|
|랜덤 포레스트(random forest)|둘 다|
|나이브 베이즈(Naive Bayes)|분류|
|서포트 벡터 머신(support vector machine, SVM)|분류|
  
### 비지도 머신러닝

비지도 머신러닝은 레이블을 예측한다기보다는 데이터 구조를 잘 이해하도록 도움을 주는 것 e.g) 클러스터링 - 비슷한 데이터들끼리 군집화(클러스터링)

⇒ 이상값 감지, 지도 머신러닝을 위한 전처리 단계로 사용

- MLlib의 일부 비지도 머신러닝 알고리즘에는 k-평균, 잠재 디리클레 할당 및 가우시안 혼합 모델이 포함 됨

### 왜 머신러닝을 위한 스파크인가?

1. 스파크는 데이터 수집, 피처 엔지니어링, 모델 교육 및 배포를 위한 에코시스템을 제공하는 통합 분석 엔진. 
2. 개발자가 스파크 없이 이러한 일련의 작업을 수행하기 위해서는 여러 도구가 필요하고 확장성 문제는 여전히 어려움이 있음
3. 스파크에는 spark.mllib와 spark.ml 두가지 머신러닝 패키지가 있음
- spark.mllib은 RDD API를 기반으로 하는 기존의 머신러닝 API
- spark.ml은 데이터 프레임을 기반으로 하는 최신 API (이 장에서는 spark.ml 패키지를 사용)

spark.ml을 사용하면 데이터 과학자는 단일 시스템에 맞게 데이터를 다운샘플링할 필요 없이 데이터 준비 및 모델 구축을 하나의 에코시스템으로 사용할 수 있음
- spark.ml은 모델이 보유한 데이터 포인트 수에 따라 선형으로 확장되는 O(n) 확장에 중점을 두어 방대한 양의 데이터로 확장할 수 있음
- 다음장에서 spark.ml과 같은 분산 프레임워크와 사이킷런과 같은 단일 노드 프레임워크 사이에서 선택하는 것과관련된 몇 가지 절충안에 대해 논의할 예정

## 2. 머신러닝 파이프라인 설계

파이프라인: 데이터에 적용할 일련의 작업을 구성하는 방법(많은 ML 프레임워크에서 일반적)
MLlib에서 파이프라인 API는 머신러닝 워크플로를 구성하기 위해 데이터 프레임 위에 구축된 고급 API를 제공.
파이프라인 API는 일련의 변환기transformer와 추정기estimator로 구성됨

### MLlib 주요 용어
- 변환기(transformer) : 데이터 프레임을 입력으로 받아들이고, 하나 이상의 열이 추가된 새 데이터 프레임을 반환
- 추정기(estimator) : .fit() 메서드를 통해 데이터 프레임에서 매개변수를 학습하고 변환기인 model을 반환
- 파이프라인 : 일련의 변환기와 추정기를 단일 모델로 구성. 파이프라인 자체가 추정기인 반면, pipeline.fit()의 출력은 변환기인 PipelineModel을 반환

### 데이터 수집 및 탐색

```python
filePath = “””/databricks-datasets/learning-spark-v2/sf-airbnb/sf-airbnb-clean.parquet/“””
airbnbDF = spark.read.parquet(filePath)
airbnbDF.select(“neighbourhood_cleansed”,”room_type”,”bedrooms”,”bathrooms”,number_of_reviews”,”price”).show(5)
```

### 학습 및 테스트 데이터세트 생성

피처 엔지니어링 및 모델링을 시작하기 전, 데이터 세트를 학습 및 테스트의 두 그룹으로 나눔.
많은 경우, 80/20을 표준 학습/테스트 분할로 사용

- 전체 데이터 세트에 대한 모델을 구축하면, 모델이 우리가 제공한 훈련 데이터를 기억하거나 ‘오버피팅’할 수있기 때문에
- 테스트 세트에 대한 모델의 성능은 데이터가 유사한 분포를 따른다고 가정할때, 보지 못한 데이터에서 얼마나 잘 수행되는지에 대한 결과

훈련세트: 특성세트 X와 레이블y로 구성

X는 차원이 n x d인 행렬로 나타냄
n은 데이터포인트의 수이고, d는 기능의 수(필드 또는 열)
y는 차원이  n x 1 인 벡터

### 변환기를 사용하여 기능 준비

- 선형 회귀 모델은 Input으로 들어갈 데이터가 모두 데이터 프레임의 단일 벡터에 들어있어야 하기 때문에 변환이 필요함  
- transform() 메서드와 VectorAssembler 변환기로 단일 벡터(단일 열)에 넣어준다.

### 선형 회귀 이해하기

- 알려진 다른 관련 데이터 값을 사용하여 알 수 없는 데이터의 값을 예측하는 데이터 분석 기법
- 알 수 없는 변수 또는 종속 변수 = y 
  알려진 변수 또는 독립 변수 = x1, x2, x3
  위의 변수들을 선형 방정식, 수학적으로 모델링한다.
- Ex) 단일 기능 x를 가정한다면 **y = mx + b** (m:기울기 b:절편)으로 표현 가능
- 모든 데이터 포인트가 완벽하게 정렬되지 않으므로 관측 값와 예측 값 간의 차이인 **잔차**를 가지고 잔차의 제곱을 최소화하는 선을 찾는 것이 목적이다.
- 만약 다중 기능 x_1,  x_2, x_3을 가정한다면 m에 해당하는 weight이 많아진다. 모델에 대한 계수와 절편을 추정하기 위해 매개변수 학습(fitting)을 하는데, 일단 일변량 회귀 먼저 살펴보자.

### 추정기를 사용하여 모델 구축

### 파이프라인 생성

#### 원핫 인코딩

### 모델 평가

#### RMSE

#### RMSE 값 해석

### 모델 저장 및 

## 3. 하이퍼파라미터 튜닝

















